import '../auth/auth_util.dart';import '../backend/backend.dart';import '../flutter_flow/flutter_flow_theme.dart';import '../flutter_flow/flutter_flow_util.dart';import '../flutter_flow/flutter_flow_widgets.dart';import 'package:auto_size_text/auto_size_text.dart';import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/material.dart';import 'package:font_awesome_flutter/font_awesome_flutter.dart';import 'package:google_fonts/google_fonts.dart';class TasksWidget extends StatefulWidget {  const TasksWidget({Key? key}) : super(key: key);  @override  _TasksWidgetState createState() => _TasksWidgetState();}class _TasksWidgetState extends State<TasksWidget> {  Map<TasksRecord, bool> checkboxValueMap = {};  List<TasksRecord> get checkboxCheckedItems =>      checkboxValueMap.entries.where((e) => e.value).map((e) => e.key).toList();  final scaffoldKey = GlobalKey<ScaffoldState>();  @override  Widget build(BuildContext context) {    return Scaffold(      key: scaffoldKey,      backgroundColor: FlutterFlowTheme.of(context).primaryBackground,      floatingActionButton: Visibility(        visible: valueOrDefault(currentUserDocument?.taskCount, 0) > 0,        child: AuthUserStreamWidget(          child: FloatingActionButton(            onPressed: () async {              context.pushNamed('Form');            },            backgroundColor: FlutterFlowTheme.of(context).primaryColor,            elevation: 8,            child: Icon(              Icons.add,              color: FlutterFlowTheme.of(context).primaryBtnText,              size: 24,            ),          ),        ),      ),      body: SafeArea(        child: GestureDetector(          onTap: () => FocusScope.of(context).unfocus(),          child: SingleChildScrollView(            child: Column(              mainAxisSize: MainAxisSize.max,              children: [                if (!((valueOrDefault(currentUserDocument?.taskCount, 0) ==                        1) ||                    (valueOrDefault(currentUserDocument?.taskCount, 0) > 1)))                  Padding(                    padding: EdgeInsetsDirectional.fromSTEB(20, 0, 20, 0),                    child: AuthUserStreamWidget(                      child: ListView(                        padding: EdgeInsets.zero,                        shrinkWrap: true,                        scrollDirection: Axis.vertical,                        children: [                          Container(                            width: MediaQuery.of(context).size.width,                            height: MediaQuery.of(context).size.height * 1,                            decoration: BoxDecoration(                              color: Color(0x00FFFFFF),                            ),                            child: Column(                              mainAxisSize: MainAxisSize.max,                              mainAxisAlignment: MainAxisAlignment.center,                              crossAxisAlignment: CrossAxisAlignment.center,                              children: [                                FaIcon(                                  FontAwesomeIcons.tasks,                                  color: Color(0xFF7C8791),                                  size: 90,                                ),                                Padding(                                  padding: EdgeInsetsDirectional.fromSTEB(                                      0, 24, 0, 0),                                  child: Row(                                    mainAxisSize: MainAxisSize.max,                                    mainAxisAlignment: MainAxisAlignment.center,                                    children: [                                      Text(                                        'You haven\'t created any tasks',                                        textAlign: TextAlign.center,                                        style: FlutterFlowTheme.of(context)                                            .title3                                            .override(                                              fontFamily: 'Outfit',                                              color: Color(0xFF090F13),                                              fontSize: 20,                                              fontWeight: FontWeight.w500,                                            ),                                      ),                                    ],                                  ),                                ),                                Padding(                                  padding: EdgeInsetsDirectional.fromSTEB(                                      12, 4, 12, 0),                                  child: Row(                                    mainAxisSize: MainAxisSize.max,                                    mainAxisAlignment: MainAxisAlignment.center,                                    children: [                                      Expanded(                                        child: Text(                                          'Start creating tasks to see your tasks here',                                          textAlign: TextAlign.center,                                          style: FlutterFlowTheme.of(context)                                              .bodyText2                                              .override(                                                fontFamily: 'Outfit',                                                color: Color(0xFF7C8791),                                                fontSize: 14,                                                fontWeight: FontWeight.normal,                                              ),                                        ),                                      ),                                    ],                                  ),                                ),                                Padding(                                  padding: EdgeInsetsDirectional.fromSTEB(                                      0, 12, 0, 0),                                  child: FFButtonWidget(                                    onPressed: () async {                                      context.pushNamed('Form');                                    },                                    text: 'Create Task',                                    options: FFButtonOptions(                                      width: 170,                                      height: 50,                                      color: FlutterFlowTheme.of(context)                                          .primaryColor,                                      textStyle: FlutterFlowTheme.of(context)                                          .subtitle2                                          .override(                                            fontFamily: 'Lexend Deca',                                            color: Colors.white,                                            fontSize: 16,                                            fontWeight: FontWeight.normal,                                          ),                                      elevation: 2,                                      borderSide: BorderSide(                                        color: Colors.transparent,                                        width: 1,                                      ),                                    ),                                  ),                                ),                              ],                            ),                          ),                        ],                      ),                    ),                  ),                if (valueOrDefault(currentUserDocument?.taskCount, 0) > 0)                  Padding(                    padding: EdgeInsetsDirectional.fromSTEB(20, 40, 20, 0),                    child: AuthUserStreamWidget(                      child: StreamBuilder<List<TasksRecord>>(                        stream: queryTasksRecord(                          queryBuilder: (tasksRecord) => tasksRecord                              .where('user', isEqualTo: currentUserReference),                        ),                        builder: (context, snapshot) {                          // Customize what your widget looks like when it's loading.                          if (!snapshot.hasData) {                            return Center(                              child: SizedBox(                                width: 50,                                height: 50,                                child: CircularProgressIndicator(                                  color:                                      FlutterFlowTheme.of(context).primaryColor,                                ),                              ),                            );                          }                          List<TasksRecord> listViewTasksRecordList =                              snapshot.data!;                          return ListView.builder(                            padding: EdgeInsets.zero,                            shrinkWrap: true,                            scrollDirection: Axis.vertical,                            itemCount: listViewTasksRecordList.length,                            itemBuilder: (context, listViewIndex) {                              final listViewTasksRecord =                                  listViewTasksRecordList[listViewIndex];                              return Card(                                clipBehavior: Clip.antiAliasWithSaveLayer,                                color: Color(0xFFF5F5F5),                                child: Padding(                                  padding: EdgeInsetsDirectional.fromSTEB(                                      0, 12, 10, 12),                                  child: Row(                                    mainAxisSize: MainAxisSize.max,                                    mainAxisAlignment:                                        MainAxisAlignment.spaceBetween,                                    crossAxisAlignment:                                        CrossAxisAlignment.start,                                    children: [                                      Row(                                        mainAxisSize: MainAxisSize.max,                                        crossAxisAlignment:                                            CrossAxisAlignment.start,                                        children: [                                          Theme(                                            data: ThemeData(                                              checkboxTheme: CheckboxThemeData(                                                shape: RoundedRectangleBorder(                                                  borderRadius:                                                      BorderRadius.circular(0),                                                ),                                              ),                                              unselectedWidgetColor:                                                  Color(0xFF818181),                                            ),                                            child: Checkbox(                                              value: checkboxValueMap[                                                      listViewTasksRecord] ??=                                                  listViewTasksRecord.status!,                                              onChanged: (newValue) async {                                                setState(() => checkboxValueMap[                                                        listViewTasksRecord] =                                                    newValue!);                                                if (newValue!) {                                                  final tasksUpdateData =                                                      createTasksRecordData(                                                    status: true,                                                  );                                                  await listViewTasksRecord                                                      .reference                                                      .update(tasksUpdateData);                                                }                                              },                                              activeColor:                                                  FlutterFlowTheme.of(context)                                                      .primaryColor,                                            ),                                          ),                                          Container(                                            width: MediaQuery.of(context)                                                    .size                                                    .width *                                                0.55,                                            decoration: BoxDecoration(                                              color: Color(0x00FFFFFF),                                            ),                                            child: Padding(                                              padding: EdgeInsetsDirectional                                                  .fromSTEB(0, 4, 0, 0),                                              child: AutoSizeText(                                                listViewTasksRecord.task!,                                                style: FlutterFlowTheme.of(                                                        context)                                                    .bodyText1                                                    .override(                                                      fontFamily: 'Roboto',                                                      color: listViewTasksRecord                                                              .status!                                                          ? Color(0xFFB7B7B7)                                                          : FlutterFlowTheme.of(                                                                  context)                                                              .primaryText,                                                      fontSize: 16,                                                      fontWeight:                                                          FontWeight.normal,                                                    ),                                              ),                                            ),                                          ),                                        ],                                      ),                                      Padding(                                        padding: EdgeInsetsDirectional.fromSTEB(                                            0, 4, 0, 0),                                        child: Text(                                          dateTimeFormat('yMMMd',                                              listViewTasksRecord.due!),                                          style: FlutterFlowTheme.of(context)                                              .bodyText1                                              .override(                                                fontFamily: 'Roboto',                                                color:                                                    listViewTasksRecord.status!                                                        ? Color(0x00818181)                                                        : Color(0xFF818181),                                              ),                                        ),                                      ),                                    ],                                  ),                                ),                              );                            },                          );                        },                      ),                    ),                  ),                Padding(                  padding: EdgeInsetsDirectional.fromSTEB(0, 40, 0, 0),                  child: FFButtonWidget(                    onPressed: () async {                      GoRouter.of(context).prepareAuthEvent();                      await signOut();                      context.goNamedAuth('Splash', mounted);                    },                    text: 'Logout',                    options: FFButtonOptions(                      width: 130,                      height: 40,                      color: FlutterFlowTheme.of(context).alternate,                      textStyle:                          FlutterFlowTheme.of(context).subtitle2.override(                                fontFamily: 'Roboto',                                color: Colors.white,                              ),                      borderSide: BorderSide(                        color: Colors.transparent,                        width: 1,                      ),                      borderRadius: BorderRadius.circular(8),                    ),                  ),                ),              ],            ),          ),        ),      ),    );  }}